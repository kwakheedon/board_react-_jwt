package com.example.board.domain.comment;

import java.util.List;

import org.springframework.http.ResponseEntity;
import org.springframework.security.core.annotation.AuthenticationPrincipal;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PatchMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.example.board.domain.comment.dto.CommentReq;
import com.example.board.domain.comment.dto.CommentRes;
import com.example.board.domain.comment.dto.CommentUpdateReq;
import com.example.board.exception.ApiResponse;
import com.example.board.security.jwt.CustomUserDetails;

import lombok.RequiredArgsConstructor;

@RestController
@RequestMapping("/api")
@RequiredArgsConstructor
public class CommentController {
	private final CommentService commentService;
	
	///댓글생성
	@PostMapping("/comments") 
    public ResponseEntity<ApiResponse<Void>> createComment( 
            @AuthenticationPrincipal CustomUserDetails userDetails,
            @RequestBody CommentReq req) {
        //서비스 메소드에 필요한 파라미터를 모두 전달
        commentService.createComment(req, userDetails.getMember().getEmail());
        return ResponseEntity.ok(ApiResponse.success("댓글 작성 성공", null));
    }

	
	///댓글조회 
	@GetMapping("/posts/{postId}/comments")
	public ResponseEntity<ApiResponse<List<CommentRes>>> readComments(@PathVariable Long postId) {
	    List<CommentRes> commentList = commentService.readComments(postId);
	    return ResponseEntity.ok(ApiResponse.success("댓글 조회 성공", null));
	}
	
	///댓글수정
	@PatchMapping("/posts/{postId}/comments/{commentId}")
	public ResponseEntity<ApiResponse<Void>> updateComment(
	        @PathVariable Long postId,
	        @PathVariable Long commentId,
	        @RequestBody  CommentUpdateReq request,
	        @AuthenticationPrincipal CustomUserDetails userDetails) {

	    commentService.updateComment(commentId, postId, userDetails.getMember().getEmail(), request);
	    return ResponseEntity.ok(ApiResponse.success("댓글 수정 성공", null));
	}
	
}

