package com.example.board.domain.post;

import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.example.board.domain.member.Member;
import com.example.board.domain.member.MemberRepository;
import com.example.board.domain.post.dto.PostReq;
import com.example.board.exception.CustomException;
import com.example.board.exception.ErrorCode;

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
public class PostService {
	private final PostRepository postRepository;
	private final MemberRepository memberRepository;
	
	//게시글생성
	@Transactional
	public Long create(PostReq postReq, String email) {
	    // 1. 작성자 정보 조회 (서비스의 책임)
	    Member member = memberRepository.findByEmail(email)
	            .orElseThrow(() -> new CustomException(ErrorCode.USER_NOT_FOUND, "해당 사용자를 찾을 수 없습니다."));
	   
	    Post post = postReq.toEntity(member);
	    Post savedPost = postRepository.save(post);
	    return savedPost.getId();
	}
	
}
